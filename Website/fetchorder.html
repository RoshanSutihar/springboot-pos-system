<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Order Details</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="style.css">
    <style>
        /* CSS for side-by-side form elements */
        .form-group {
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>

<!-- Navigation -->

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="dashboard.html">Dashboard<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item dropdown active">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Orders
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink1">
            <a class="dropdown-item" href="#">Add Order</a>
            <a class="dropdown-item" href="#">View Order</a>
            <a class="dropdown-item" href="fetechorder.html">Search Order</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Products
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink2">
            <a class="dropdown-item" href="#">Add Product</a>
            <a class="dropdown-item" href="#">View Products</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Suppliers
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink3">
            <a class="dropdown-item" href="#">Add Supplier</a>
            <a class="dropdown-item" href="#">View Suppliers</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink4" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Customers
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink4">
            <a class="dropdown-item" href="#">Add Customer</a>
            <a class="dropdown-item" href="#">View Customers</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="register-user.html">Register User</a>
        </li>
      </ul>
    </div>
  </nav>


  <!-- Main fetch system -->


    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
        <form id="order-form">
            <div class="form-group">
                <label for="order-id">Order ID:</label>
                <input type="text" class="form-control" id="order-id" placeholder="Enter Order ID " required>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            <p id="error-message" style="color: red;"></p>
        </form>
            </div>
        </div>


        <div id="order-details" class="mt-5" style="display: none;">
            <h2>Order Details</h2>
            <form id="view-order-form">
                <div class="form-group">
                    <label for="order-id-disabled">Order ID:</label>
                    <input type="text" class="form-control" id="order-id-disabled" disabled>
                </div>
                <div class="form-group">
                    <label for="customer-id">Customer Name:</label>
                    <input type="text" class="form-control" id="customer-id" disabled>
                </div>
                <div class="form-group">
                    <label for="order-date">Order Date:</label>
                    <input type="text" class="form-control" id="order-date" disabled>
                </div>
                
                <div class="form-group">
                    <label for="ship-date">Ship Date:</label>
                    <input type="text" class="form-control" id="ship-date" disabled>
                </div>
                <div class="form-group">
                    <label for="total-amount">Total Amount:</label>
                    <input type="text" class="form-control" id="total-amount" disabled>
                </div>
            </form>

            <table class="table mt-3">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Product Total</th>
                    </tr>
                </thead>
                <tbody id="order-details-table">
                    <!-- Order details will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </div>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <button id="print-button" class="btn btn-secondary mt-3" style="display: none;">Print Order Details</button>
            </div>
        </div>
    </div>


    <script>
    
        function checkLoggedIn() {
           
            var username = sessionStorage.getItem('username');
            if (!username) {
              
                window.location.href = 'index.html';
            }
        }
        
      
        checkLoggedIn();
      </script>


    <script>
        $(document).ready(function() {
            // Handle form submission
            $('#order-form').submit(function(event) {
                event.preventDefault();
                var orderId = $('#order-id').val();
                // Make AJAX call to fetch order details
                $.get('http://localhost:8085/orders/viewdetails/' + orderId, function(data) {
                    try {
                        // Parse the text response into JSON format
                        data = JSON.parse(data);
                        // Populate order details form
                        $('#order-id-disabled').val(data.orderID);
                        $('#order-date').val(data.orderDate);
                        $('#customer-id').val(data.customerID);
                        $('#ship-date').val(data.shipDate);
                        $('#total-amount').val('$' + data.totalAmount.toFixed(2));
                        // Populate order details table
                        var orderDetailsTable = '';
                        data.orderDetails.forEach(function(detail) {
                            orderDetailsTable += '<tr>';
                            orderDetailsTable += '<td>' + detail.productId + '</td>';
                            orderDetailsTable += '<td>' + detail.productQty + '</td>';
                            orderDetailsTable += '<td>$' + detail.unitPrice.toFixed(2) + '</td>';
                            orderDetailsTable += '<td>$' + detail.productTotal.toFixed(2) + '</td>';
                            orderDetailsTable += '</tr>';
                        });
                        $('#order-details-table').html(orderDetailsTable);
                        // Show order details section
                        $('#order-details').show();
                        // Hide error message if displayed
                        $('#error-message').hide();
                        $('#order-form').hide();
                    } catch (error) {
                        // Display error message
                        $('#error-message').text('Order details not availabe.').show();
                        // Hide order details section
                        $('#order-details').hide();
                    }
                }).fail(function() {
                    // Display error message
                    $('#error-message').text('Failed to fetch order details.').show();
                    // Hide order details section
                    $('#order-details').hide();
                });
            });
            $('.container#print-button').click(function() {
                
               
                window.print();
                
            });
        });
    </script>


    <!-- Main fetch system end -->


    <!-- to make dropdown work -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>